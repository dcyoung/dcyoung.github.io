<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>​Estimating Fundamental Matrix ​&amp; Triangulating 3D Points</title>
<meta name="description" content="Estimating a fundamental matrix to triangulate and reconstruct 2D points in 3D space.">


  <meta name="author" content="David Young">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="David Young">
<meta property="og:title" content="​Estimating Fundamental Matrix ​&amp; Triangulating 3D Points">
<meta property="og:url" content="https://dcyoung.github.io/pages/dcyoung/post-estimating-fundamental-matrix/">


  <meta property="og:description" content="Estimating a fundamental matrix to triangulate and reconstruct 2D points in 3D space.">



  <meta property="og:image" content="https://dcyoung.github.io/pages/dcyoung/images/estimating-fundamental-matrix/3.webp">





  <meta property="article:published_time" content="2016-04-02T07:00:00+07:00">



  <meta property="article:modified_time" content="2016-04-02T07:00:00+07:00">




<link rel="canonical" href="https://dcyoung.github.io/pages/dcyoung/post-estimating-fundamental-matrix/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "David Young",
      "url": "https://dcyoung.github.io/pages/dcyoung/",
      "sameAs": ["https://www.linkedin.com/in/david-young-09509210a"]
    
  }
</script>






<!-- end _includes/seo.html -->


  <link href="/pages/dcyoung/feed.xml" type="application/atom+xml" rel="alternate" title="David Young Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/pages/dcyoung/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->
<link rel="shortcut icon" href="/images/site/favicon.ico">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>
<meta name="google-site-verification" content="zewSCzlO5JWAuo7MV_u4VoTRLfV4lUrqwxvfo4-3Xfc" />
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: ["tex2jax.js"],
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
       processEscapes: true,
       preview: 'none'
     },
     messageStyle: 'none',
     "HTML-CSS": { availableFonts: ["TeX"] }
   });

</script>

<style>
    .bg-color-red {
        background-color: #ffebee;
    }

    .bg-color-green {
        background-color: #e8f5e9;
    }

    .bg-color-yellow {
        background-color: #fff3e0;
    }

    .bg-color-dark-green {
        background-color: #c8e6c9;
    }

    .bg-color-pink {
        background-color: #ffcdd2;
    }

    .bg-color-purple {
        background-color: #c5cae9;
    }

    .pwc-icon {
        width: 23px;
        height: 23px;
        position: relative;
        top: 5px;
        margin-right: 5px;
    }

</style>

  </head>

  <body class="layout--single wide" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/pages/dcyoung/">
          David Young
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/pages/dcyoung/archives/"
                
                
              >Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/pages/dcyoung/about/"
                
                
              >About</a>
            </li><li class="masthead__menu-item">
              <a
                href="/pages/dcyoung/resume/"
                
                
              >Resume</a>
            </li><li class="masthead__menu-item">
              <a
                href="/pages/dcyoung/ml-practitioners-guide/"
                
                
              >ML Practitioner's Guide</a>
            </li><li class="masthead__menu-item">
              <a
                href="/pages/dcyoung/categories/"
                
                
              >Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://dcyoung.github.io/pages/dcyoung/">
        <img src="/pages/dcyoung/images/site/profile_artsy.webp" alt="David Young" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://dcyoung.github.io/pages/dcyoung/" itemprop="url">David Young</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>systems thinker &amp; passionate engineer</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://github.com/dcyoung" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/david-young-09509210a" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">Linkedin</span></a></li>
          
        
          
            <li><a href="https://www.instagram.com/cycle_shadez/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
          
            <li><a href="https://www.youtube.com/channel/UClQEBd-MzkWlkjbxcsve-UA" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span></a></li>
          
        
          
            <li><a href="mailto:david@questionablyartificial.com" rel="nofollow noopener noreferrer me"><i class="fab fa-fw fa-envelope" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="​Estimating Fundamental Matrix ​&amp; Triangulating 3D Points">
    <meta itemprop="description" content="Estimating a fundamental matrix to triangulate and reconstruct 2D points in 3D space.">
    <meta itemprop="datePublished" content="2016-04-02T07:00:00+07:00">
    <meta itemprop="dateModified" content="2016-04-02T07:00:00+07:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://dcyoung.github.io/pages/dcyoung/post-estimating-fundamental-matrix/" itemprop="url">​Estimating Fundamental Matrix ​&amp; Triangulating 3D Points
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#fitting-a-fundamental-matrix-provided-known-matches">Fitting a Fundamental Matrix (Provided Known Matches)</a></li><li><a href="#results-fitting-fundamental">Results (Fitting Fundamental)</a></li><li><a href="#generalized-ransac">Generalized RANSAC</a></li><li><a href="#estimating-fundamental-matrix-using-ransac">Estimating Fundamental Matrix using RANSAC</a><ul><li><a href="#calling-the-ransac-for-fundamental-parameters">Calling the RANSAC for fundamental (parameters)</a></li><li><a href="#results-estimating-fundamental">Results (Estimating Fundamental)</a></li></ul></li><li><a href="#triangulation">Triangulation</a><ul><li><a href="#calculating-triangulated-points-and-their-projections">Calculating Triangulated Points and their Projections</a></li><li><a href="#plotting-triangulation">Plotting Triangulation</a></li><li><a href="#results-triangulation">Results (Triangulation)</a></li></ul></li></ul>
            </nav>
          </aside>
        
        <p>There were a few goals here. All goals refer to matching points from two images of the same scene from different camera positions.</p>

<ul>
  <li>Fit a fundamental matrix to the known matches using both the normalized and unnormalized versions of the 8-point algorithm.</li>
  <li>Estimate the fundamental matrix from putative matches using RANSAC and the normalized 8-point algorithm.</li>
  <li>Find the centers of cameras from known camera matrices.</li>
  <li>Use linear least squares to triangulate the position of each matching pair of points given two cameras. Display these two camera centers and reconstructed points in 3D.</li>
</ul>

<p>The source code can be obtained here: <a href="https://github.com/dcyoung/FundamentalMatrixEstimation">github.com/dcyoung/FundamentalMatrixEstimation</a></p>

<h2 id="fitting-a-fundamental-matrix-provided-known-matches">Fitting a Fundamental Matrix (Provided Known Matches)</h2>

<p>The following function was written to to fit a fundamental matrix using either the normalized or un-normalized 8 point algorithm.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="p">[</span> <span class="n">F</span> <span class="p">]</span> <span class="o">=</span> <span class="n">fit_fundamental</span><span class="p">(</span> <span class="n">matches</span><span class="p">,</span> <span class="n">bShouldNormalize</span> <span class="p">)</span>
<span class="c1">%FIT_FUNDAMENTAL Summary of this function goes here</span>
<span class="c1">%Output...</span>
<span class="c1">%   F: Fundamental Matrix</span>
<span class="c1">%Inputs...</span>
<span class="c1">%   matches:</span>
<span class="c1">%       This is a N x 4 file where the first two numbers of each row</span>
<span class="c1">%       are coordinates of corners in the first image and the last two</span>
<span class="c1">%       are coordinates of corresponding corners in the second image: </span>
<span class="c1">%       matches(i,1:2) is a point in the first image</span>
<span class="c1">%       matches(i,3:4) is a corresponding point in the second image</span>
<span class="c1">%   bShouldNormalize:</span>
<span class="c1">%       Whether or not the points should be normalized prior to estimating </span>
<span class="c1">%       the fundamental matrix</span>

    <span class="c1">%homogenize the points</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">cart_2_homo</span><span class="p">(</span> <span class="n">matches</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">cart_2_homo</span><span class="p">(</span> <span class="n">matches</span><span class="p">(:,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="p">);</span>
    
    <span class="k">if</span> <span class="n">bShouldNormalize</span>
        <span class="p">[</span><span class="n">transform_1</span><span class="p">,</span> <span class="n">x1_norm</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize_coordinates</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
        <span class="p">[</span><span class="n">transform_2</span><span class="p">,</span> <span class="n">x2_norm</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize_coordinates</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x1_norm</span><span class="p">;</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x2_norm</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="n">u1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
   
    <span class="c1">%group at least 8 known matches together in a useful form</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span> <span class="n">u2</span><span class="o">.*</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="o">.*</span><span class="n">v1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="o">.*</span><span class="n">u1</span><span class="p">,</span> <span class="n">v2</span><span class="o">.*</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)];</span>
    <span class="c1">%Obtain an estimate for F by solving the homogenous linear system using</span>
    <span class="c1">%those matches</span>
    <span class="c1">%display('Solving homogenous linear system');</span>
    <span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="o">~</span><span class="p">,</span><span class="n">V</span><span class="p">]</span> <span class="o">=</span> <span class="nb">svd</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
    <span class="n">f_vec</span> <span class="o">=</span> <span class="n">V</span><span class="p">(:,</span><span class="mi">9</span><span class="p">);</span>
    
    <span class="n">F</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">f_vec</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="c1">%reshape the 9x1 vec into the 3x3 fund matrix</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">rank_2_constraint</span><span class="p">(</span><span class="n">F</span><span class="p">);</span> <span class="c1">%enforce the rank 2 constraint on F</span>
    
    <span class="k">if</span> <span class="n">bShouldNormalize</span>
        <span class="c1">%if F was computed from normalized points, transform it back to</span>
        <span class="c1">%the original coordinates</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">transform_2</span><span class="o">'</span> <span class="o">*</span> <span class="n">F</span> <span class="o">*</span> <span class="n">transform_1</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The linear system to be solved will have terms that involve a product between feature coordinates. If the coordinates are large, then F could end up w/ values that are orders of magnitude different from one another. This could yield poor behavior in practice. So it is best to do the following:</p>

<ul>
  <li>normalize the coordinates</li>
  <li>compute F in the normalized coordinates</li>
  <li>adjust it back to the original coordinates later using the normalization transformations</li>
</ul>

<p>​The following function handles normalization for the normalized 8 point algorithm. The transform is passed back to the caller so that the F matrix may be transformed after fitting.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="p">[</span> <span class="nb">transform</span><span class="p">,</span> <span class="n">normCoord</span> <span class="p">]</span> <span class="o">=</span> <span class="n">normalize_coordinates</span><span class="p">(</span> <span class="n">homoCoord</span> <span class="p">)</span>
<span class="c1">%NORMALIZE_COORDINATES Summary of this function goes here</span>
<span class="c1">%   Detailed explanation goes here</span>

    <span class="n">center</span> <span class="o">=</span> <span class="nb">mean</span><span class="p">(</span><span class="n">homoCoord</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">));</span> 
    
    <span class="n">offset</span> <span class="o">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">offset</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">center</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">%-mu_x</span>
    <span class="n">offset</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">center</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">%-mu_y</span>

    <span class="n">sX</span><span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">homoCoord</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)));</span>
    <span class="n">sY</span><span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">homoCoord</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)));</span>
    
    <span class="nb">scale</span> <span class="o">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="nb">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="n">sX</span><span class="p">;</span>
    <span class="nb">scale</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="n">sY</span><span class="p">;</span>          
                
    <span class="nb">transform</span> <span class="o">=</span> <span class="nb">scale</span> <span class="o">*</span> <span class="n">offset</span><span class="p">;</span>
    <span class="n">normCoord</span> <span class="o">=</span> <span class="p">(</span><span class="nb">transform</span> <span class="o">*</span> <span class="n">homoCoord</span><span class="s1">')'</span><span class="p">;</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Also a function was written to enforce the rank2 constraint for the F matrix.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="p">[</span> <span class="n">rank2_mat</span> <span class="p">]</span> <span class="o">=</span> <span class="n">rank_2_constraint</span><span class="p">(</span> <span class="n">mat</span> <span class="p">)</span>
<span class="c1">%RANK_2_CONSTRAINT Enforce a rank 2 constraint on 3x3 input matrix</span>
<span class="c1">%   Detailed explanation goes here</span>

    <span class="c1">%display('Enforcing Rank 2 Constraint');</span>
    <span class="c1">%take the svd of the input matrix</span>
    <span class="p">[</span><span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span><span class="p">]</span> <span class="o">=</span> <span class="nb">svd</span><span class="p">(</span><span class="n">mat</span><span class="p">);</span>
    <span class="c1">%throw out the smallest singular value</span>
    <span class="n">S</span><span class="p">(</span><span class="k">end</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">%recalcualte the matrix to yield the closest rank 2 constraint of the</span>
    <span class="c1">%original</span>
    <span class="n">rank2_mat</span> <span class="o">=</span> <span class="n">U</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">V</span><span class="o">'</span><span class="p">;</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To gauge the quality of the fit model, the following function was written to calculate the the mean squared distance in pixels between points in both images and the corresponding epipolar lines.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">residuals</span> <span class="o">=</span> <span class="n">calc_residuals</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
<span class="c1">%CALC_RESIDUALS Summary of this function goes here</span>
<span class="c1">%   Detailed explanation goes here</span>
   
    <span class="n">numMatches</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">F</span> <span class="o">*</span> <span class="p">[</span><span class="n">matches</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="nb">ones</span><span class="p">(</span><span class="n">numMatches</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span><span class="s1">')'</span><span class="p">;</span> <span class="c1">% transform points from </span>
    <span class="c1">% the first image to get epipolar lines in the second image</span>

    <span class="c1">% find points on epipolar lines L closest to matches(:,3:4)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">L</span> <span class="o">.</span><span class="p">/</span> <span class="nb">repmat</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">L</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">% rescale the line</span>
    <span class="nb">distances</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">L</span> <span class="o">.*</span> <span class="p">[</span><span class="n">matches</span><span class="p">(:,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="nb">ones</span><span class="p">(</span><span class="n">numMatches</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span><span class="mi">2</span><span class="p">);</span> <span class="c1">%distances from each pt to its line</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">distances</span><span class="p">);</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="results-fitting-fundamental">Results (Fitting Fundamental)</h2>

<p>​The following results are for the fitting of a fundamental matrix using known ground truth matches and both the normalized and unnormalized 8 point algorithms. The table shows the mean Residuals for a Fitted F Matrix… ie: the mean squared distance in pixels between points in both images and the corresponding epipolar lines.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Image Set</th>
      <th style="text-align: center">Normalized</th>
      <th style="text-align: center">Unnormalized</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">House</td>
      <td style="text-align: center">14.5839</td>
      <td style="text-align: center">26.7532</td>
    </tr>
    <tr>
      <td style="text-align: center">Library</td>
      <td style="text-align: center">10.8974</td>
      <td style="text-align: center">11.8459</td>
    </tr>
  </tbody>
</table>

<p>Below, the images show points and segments of corresponding epipolar lines for each image set.</p>

<figure class="half">
    <img src="/images/estimating-fundamental-matrix/0.webp" />
    <img src="/images/estimating-fundamental-matrix/1.webp" />
    <figcaption>Points and segments of corresponding epipolar lines. Unnormalized (left) and Normalized (right).</figcaption>
</figure>

<figure class="half">
    <img src="/images/estimating-fundamental-matrix/2.webp" />
    <img src="/images/estimating-fundamental-matrix/3.webp" />
    <figcaption>Points and segments of corresponding epipolar lines. Unnormalized (left) and Normalized (right).</figcaption>
</figure>

<h2 id="generalized-ransac">Generalized RANSAC</h2>

<p>I wrote a generalized function to perform RANSAC when I was estimating homography. However some slight tweaks had to be made for estimating the fundamental matrix. The new version is shown below.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="p">[</span> <span class="n">bestFitModel</span><span class="p">,</span> <span class="n">inlierIndices</span> <span class="p">]</span> <span class="o">=</span> <span class="n">ransac_H</span><span class="p">(</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fitModelFxn</span><span class="p">,</span> <span class="n">errorFxn</span> <span class="p">)</span>
<span class="c1">%RANSAC_H Summary of this function goes here</span>
<span class="c1">%   Detailed explanation goes here</span>

    <span class="p">[</span><span class="n">numMatches</span><span class="p">,</span> <span class="o">~</span><span class="p">]</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">numInliersEachIteration</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">numIterations</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">storedModels</span> <span class="o">=</span> <span class="p">{};</span><span class="c1">%zeros(parameters.numIterations,3,3);</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">parameters</span><span class="o">.</span><span class="n">numIterations</span><span class="p">;</span>
        <span class="c1">%display(['Running ransac Iteration: ', num2str(i)]);</span>
        
        <span class="c1">%select a random subset of points</span>
        <span class="n">subsetIndices</span> <span class="o">=</span> <span class="n">randsample</span><span class="p">(</span><span class="n">numMatches</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">subsetSize</span><span class="p">);</span>
        <span class="n">x_subset</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">subsetIndices</span><span class="p">,</span> <span class="p">:);</span>
        <span class="n">y_subset</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">subsetIndices</span><span class="p">,</span> <span class="p">:);</span>
            
        <span class="c1">%fit a model to that subset</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">fitModelFxn</span><span class="p">(</span><span class="n">x_subset</span><span class="p">,</span> <span class="n">y_subset</span><span class="p">);</span>
        
        <span class="c1">%compute inliers, ie: find all remaining points that are </span>
        <span class="c1">%"close" to the model and reject the rest as outliers</span>
        <span class="n">residualErrors</span> <span class="o">=</span> <span class="n">errorFxn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        
        <span class="n">inlierIndices</span> <span class="o">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">residualErrors</span> <span class="o">&lt;</span> <span class="n">parameters</span><span class="o">.</span><span class="n">inlierDistThreshold</span><span class="p">);</span>      

        <span class="c1">%record the number of inliers</span>
        <span class="n">numInliersEachIteration</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">inlierIndices</span><span class="p">);</span>
        
        <span class="c1">%keep track of any models that generated an acceptable numbers of </span>
        <span class="c1">%inliers. This collection can be parsed later to find the best fit</span>
        <span class="n">currentInlierRatio</span> <span class="o">=</span> <span class="n">numInliersEachIteration</span><span class="p">(</span><span class="n">i</span><span class="p">)/</span><span class="n">numMatches</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">currentInlierRatio</span> <span class="o">&gt;=</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">minInlierRatio</span>
            <span class="c1">%re-fit the model using all of the inliers and store it</span>
            <span class="n">x_inliers</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">inlierIndices</span><span class="p">,</span> <span class="p">:);</span>
            <span class="n">y_inliers</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">inlierIndices</span><span class="p">,</span> <span class="p">:);</span>
            <span class="n">storedModels</span><span class="p">{</span><span class="n">i</span><span class="p">}</span> <span class="o">=</span> <span class="n">fitModelFxn</span><span class="p">(</span><span class="n">x_inliers</span><span class="p">,</span> <span class="n">y_inliers</span><span class="p">);</span>
        <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="c1">%retrieve the model with the best fit (highest number of inliers)</span>
    <span class="n">bestIteration</span> <span class="o">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">numInliersEachIteration</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">numInliersEachIteration</span><span class="p">));</span>
    <span class="n">bestIteration</span> <span class="o">=</span> <span class="n">bestIteration</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">%incase there was more than 1 with same value</span>
    <span class="n">bestFitModel</span> <span class="o">=</span> <span class="n">storedModels</span><span class="p">{</span><span class="n">bestIteration</span><span class="p">};</span>
    
    <span class="c1">%recalculate the inlier indices for all points, this was done once before </span>
    <span class="c1">%when calculting this model, but it wasn't stored for space reasons. </span>
    <span class="c1">%Recalculate it now so that it can be returned to the caller</span>
    <span class="n">residualErrors</span> <span class="o">=</span> <span class="n">errorFxn</span><span class="p">(</span><span class="n">bestFitModel</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">inlierIndices</span> <span class="o">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">residualErrors</span> <span class="o">&lt;</span> <span class="n">parameters</span><span class="o">.</span><span class="n">inlierDistThreshold</span><span class="p">);</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="estimating-fundamental-matrix-using-ransac">Estimating Fundamental Matrix using RANSAC</h2>

<h3 id="calling-the-ransac-for-fundamental-parameters">Calling the RANSAC for fundamental (parameters)</h3>

<p>Using an updated version of putative match generation code from before, the fundamental matrix was estimated via RANSAC. A generic implementation of RANSAC was written (above) and was called via the following function, making use of the “fit_fundamental” and “calc_residual” functions already shown. The parameters here just a ballpark. I did not not spend very much time tuning them for performance and there is likely a much better set of general parameters, on top of the need to tune parameters on a case by case basis (for best results).</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="p">[</span> <span class="n">H</span><span class="p">,</span> <span class="n">inlierIndices</span> <span class="p">]</span> <span class="o">=</span> <span class="n">estimate_homography</span><span class="p">(</span> <span class="n">img1Feat</span><span class="p">,</span> <span class="n">img2Feat</span> <span class="p">)</span>
<span class="c1">%ESTIMATE_HOMOGRAPHY Summary of this function goes here</span>
<span class="c1">%   Detailed explanation goes here</span>

    <span class="n">parameters</span><span class="o">.</span><span class="n">numIterations</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>      <span class="c1">%the number of iterations to run</span>
    <span class="n">parameters</span><span class="o">.</span><span class="n">subsetSize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>          <span class="c1">%number of matches to use each iteration</span>
    <span class="n">parameters</span><span class="o">.</span><span class="n">inlierDistThreshold</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>   <span class="c1">%the minimum distance for an inlier</span>
    <span class="n">parameters</span><span class="o">.</span><span class="n">minInlierRatio</span> <span class="o">=</span> <span class="o">.</span><span class="mi">3</span><span class="p">;</span>     <span class="c1">%minimum inlier ratio required to store a fitted model</span>

    <span class="p">[</span><span class="n">H</span><span class="p">,</span> <span class="n">inlierIndices</span><span class="p">]</span> <span class="o">=</span> <span class="n">ransac_H</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">img1Feat</span><span class="p">,</span> <span class="n">img2Feat</span><span class="p">,</span> <span class="o">@</span><span class="n">fit_homography</span><span class="p">,</span> <span class="o">@</span><span class="n">calc_residuals</span><span class="p">);</span>
    
    <span class="nb">display</span><span class="p">(</span><span class="s1">'Number of inliers:'</span><span class="p">);</span>
    <span class="nb">display</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">inlierIndices</span><span class="p">));</span>
    <span class="nb">display</span><span class="p">(</span><span class="s1">'Average residual for the inliers:'</span><span class="p">)</span>
    <span class="nb">display</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="n">calc_residuals</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">img1Feat</span><span class="p">(</span><span class="n">inlierIndices</span><span class="p">,:),</span> <span class="n">img2Feat</span><span class="p">(</span><span class="n">inlierIndices</span><span class="p">,:))));</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="results-estimating-fundamental">Results (Estimating Fundamental)</h3>

<p>​The following results are for the RANSAC estimation of a fundamental matrix using putative matches and the normalized 8 point algorithm.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Image Set</th>
      <th style="text-align: center"># of Inliers</th>
      <th style="text-align: center"># of Starting Matches</th>
      <th style="text-align: center">Mean Inlier Residual</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">House</td>
      <td style="text-align: center">85</td>
      <td style="text-align: center">100</td>
      <td style="text-align: center">8.3322</td>
    </tr>
    <tr>
      <td style="text-align: center">Library</td>
      <td style="text-align: center">174</td>
      <td style="text-align: center">200</td>
      <td style="text-align: center">12.8642</td>
    </tr>
  </tbody>
</table>

<p>Points and segments of corresponding epipolar lines for the house and library image sets are shown below. The performance has clearly dropped without known matches, but I didn’t spend a lot of time parameter tuning the call to RANSAC and the putative match generation was rather naive.</p>

<figure class="half">
    <img src="/images/estimating-fundamental-matrix/4.webp" />
    <img src="/images/estimating-fundamental-matrix/5.webp" />
</figure>

<h2 id="triangulation">Triangulation</h2>

<h3 id="calculating-triangulated-points-and-their-projections">Calculating Triangulated Points and their Projections</h3>

<p>The following snippet calculates the triangulated points and the projected triangulated points onto both images planes. The latter is for the calculation of residuals. What this means is you take the triangulated 3D point (P) and project it onto the image plane of each camera again, using the camera matrix. This reprojection yields new points (p_hat) near the original ones (p). Then, the euclidean distance between the original and reprojected point is calculated in both image planes.</p>

<p><img src="/images/estimating-fundamental-matrix/6.webp" alt="triangulation" class="align-center" /></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">...</span>

<span class="c1">%homogenize the coordinates</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">cart_2_homo</span><span class="p">(</span><span class="n">matches</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">));</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">cart_2_homo</span><span class="p">(</span><span class="n">matches</span><span class="p">(:,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">));</span>
<span class="n">numMatches</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">triangPoints</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">numMatches</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">projPointsImg1</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">numMatches</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">projPointsImg2</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">numMatches</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">%calcualte the triangulated points, + their projections onto each img plane</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">numMatches</span>
    <span class="n">pt1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">(</span><span class="n">i</span><span class="p">,:);</span>
    <span class="n">pt2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">(</span><span class="n">i</span><span class="p">,:);</span>
    <span class="n">crossProductMat1</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">0</span>   <span class="o">-</span><span class="n">pt1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="n">pt1</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">pt1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="mi">0</span>   <span class="o">-</span><span class="n">pt1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="o">-</span><span class="n">pt1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="n">pt1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="mi">0</span>  <span class="p">];</span>
    <span class="n">crossProductMat2</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">0</span>   <span class="o">-</span><span class="n">pt2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="n">pt2</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">pt2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="mi">0</span>   <span class="o">-</span><span class="n">pt2</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="o">-</span><span class="n">pt2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="n">pt2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="mi">0</span>  <span class="p">];</span>    
    <span class="n">Eqns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">crossProductMat1</span><span class="o">*</span><span class="n">camMatrix1</span><span class="p">;</span> <span class="n">crossProductMat2</span><span class="o">*</span><span class="n">camMatrix2</span> <span class="p">];</span>
    
    <span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="o">~</span><span class="p">,</span><span class="n">V</span><span class="p">]</span> <span class="o">=</span> <span class="nb">svd</span><span class="p">(</span><span class="n">Eqns</span><span class="p">);</span>
    <span class="n">triangPointHomo</span> <span class="o">=</span> <span class="n">V</span><span class="p">(:,</span><span class="k">end</span><span class="p">)</span><span class="o">'</span><span class="p">;</span> <span class="c1">%4 dim (3 dimensions + homo coord)</span>
    <span class="c1">%save the triangulated 3d point</span>
    <span class="n">triangPoints</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">homo_2_cart</span><span class="p">(</span><span class="n">triangPointHomo</span><span class="p">);</span>
    
    <span class="c1">%project the triangulated point using both camera matrices for later</span>
    <span class="c1">%residual calculations</span>
    <span class="n">projPointsImg1</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">homo_2_cart</span><span class="p">((</span><span class="n">camMatrix1</span> <span class="o">*</span> <span class="n">triangPointHomo</span><span class="s1">')'</span><span class="p">);</span>
    <span class="n">projPointsImg2</span><span class="p">(</span><span class="n">i</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">homo_2_cart</span><span class="p">((</span><span class="n">camMatrix2</span> <span class="o">*</span> <span class="n">triangPointHomo</span><span class="s1">')'</span><span class="p">);</span>
    
<span class="k">end</span>
</code></pre></div></div>

<h3 id="plotting-triangulation">Plotting Triangulation</h3>

<p>The following function was written to extract the camera centers from the camera matrices.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="p">[</span> <span class="n">cameraCenter</span> <span class="p">]</span> <span class="o">=</span> <span class="n">get_cam_center</span><span class="p">(</span> <span class="n">cameraMatrix</span> <span class="p">)</span>
<span class="c1">%GET_CAM_CENTER Summary of this function goes here</span>
<span class="c1">%   Detailed explanation goes here</span>

    <span class="p">[</span><span class="o">~</span><span class="p">,</span> <span class="o">~</span><span class="p">,</span> <span class="n">V</span><span class="p">]</span> <span class="o">=</span> <span class="nb">svd</span><span class="p">(</span><span class="n">cameraMatrix</span><span class="p">);</span>
    <span class="n">cameraCenter</span> <span class="o">=</span> <span class="n">V</span><span class="p">(:,</span><span class="k">end</span><span class="p">);</span>
    <span class="n">cameraCenter</span> <span class="o">=</span> <span class="n">homo_2_cart</span><span class="p">(</span><span class="n">cameraCenter</span><span class="o">'</span><span class="p">);</span> <span class="c1">%unhomogenize the point</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Finally, this function plots the triangulated points and the camera centers in 3d world space.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="p">[</span>  <span class="p">]</span> <span class="o">=</span> <span class="n">plot_triangulation</span><span class="p">(</span> <span class="n">triangPoints</span><span class="p">,</span> <span class="n">camCenter1</span><span class="p">,</span> <span class="n">camCenter2</span> <span class="p">)</span>
<span class="c1">%PLOT_TRIANGULATION Summary of this function goes here</span>
<span class="c1">%   Detailed explanation goes here</span>

    <span class="nb">figure</span><span class="p">;</span> <span class="nb">axis</span> <span class="n">equal</span><span class="p">;</span>  <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> 
    <span class="nb">plot3</span><span class="p">(</span><span class="o">-</span><span class="n">triangPoints</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">triangPoints</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">triangPoints</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="s1">'.r'</span><span class="p">);</span>
    <span class="nb">plot3</span><span class="p">(</span><span class="o">-</span><span class="n">camCenter1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">camCenter1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">camCenter1</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s1">'*g'</span><span class="p">);</span>
    <span class="nb">plot3</span><span class="p">(</span><span class="o">-</span><span class="n">camCenter2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">camCenter2</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">camCenter2</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s1">'*b'</span><span class="p">);</span>
    <span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">xlabel</span><span class="p">(</span><span class="s1">'x'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'y'</span><span class="p">);</span> <span class="nb">zlabel</span><span class="p">(</span><span class="s1">'z'</span><span class="p">);</span> <span class="nb">axis</span> <span class="n">equal</span><span class="p">;</span>
    
<span class="k">end</span>
</code></pre></div></div>

<h3 id="results-triangulation">Results (Triangulation)</h3>

<p>The following table shows the residuals between the observed 2D points and the projected 3D points in the two images. See the previous section for a visual representation of what this means.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Image Plane</th>
      <th style="text-align: center">Mean Dist Between Observed 2D &amp; Projected 3D Point</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">House Image 1</td>
      <td style="text-align: center">0.002522</td>
    </tr>
    <tr>
      <td style="text-align: center">House Image 2</td>
      <td style="text-align: center">0.15655</td>
    </tr>
  </tbody>
</table>

<p>The triangulated points were then plotted in 3 dimensional world space. To make things easier, adopt the following notation for viewing direction. The labeled directions “Front, Side and Top Down” views are shown below.</p>

<p><img src="/images/estimating-fundamental-matrix/7.webp" alt="ref" class="align-center" /></p>

<p>​And make note of the overlaid feature locations.</p>

<p><img src="/images/estimating-fundamental-matrix/8.webp" alt="features" class="align-center" /></p>

<p>Now that the reference material is out of the way, here are two slightly different TOP DOWN views of the triangulated points and camera centers from the “house” image set. The triangulated points are shown as red dots. The first camera center is shown as a green star and the second camera center is shown as a blue star.</p>

<figure class="half">
    <img src="/images/estimating-fundamental-matrix/9.webp" />
    <img src="/images/estimating-fundamental-matrix/10.webp" />
</figure>

<p>​The large spread out set of points on the lower/left side of the plots are all coplanar features from the tablecloth to the left of the house in the original photos. See the overlaid features images above for reference. Looking at the 3D plots, you can clearly see the corner of the building as the dense “L” shape. And as expected, the position of the second camera center is further to the right (relative to the corner). Because of this, the the blue center can see more of the side view than the green camera center.</p>

<p>Now, here are two additional views of the triangulated points and camera centers from the “house” image set. The “Front Facing” view is shown on the LEFT and the “Side Facing” view is shown on the RIGHT. The plots have been rotated to shown the ground plane of the table as a horizontal line.</p>

<figure class="half">
    <img src="/images/estimating-fundamental-matrix/11.webp" />
    <img src="/images/estimating-fundamental-matrix/12.webp" />
</figure>

<p>​The additional two views shown the front and side facing views of the house. As expected, the shape of the house can be seen from both angles. Overall, the triangulation and 3D reconstruction of the house image set turned out to be surprisingly accurate.</p>

        
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/pages/dcyoung/categories/#computer-vision" class="page__taxonomy-item p-category" rel="tag">computer vision</a><span class="sep">, </span>
    
      <a href="/pages/dcyoung/categories/#school-project" class="page__taxonomy-item p-category" rel="tag">school project</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2016-04-02">April 2, 2016</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=%E2%80%8BEstimating+Fundamental+Matrix+%E2%80%8B%26+Triangulating+3D+Points%20https%3A%2F%2Fdcyoung.github.io%2Fpages%2Fdcyoung%2Fpost-estimating-fundamental-matrix%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdcyoung.github.io%2Fpages%2Fdcyoung%2Fpost-estimating-fundamental-matrix%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://dcyoung.github.io/pages/dcyoung/post-estimating-fundamental-matrix/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/pages/dcyoung/post-fiducial-marker-tracking-for-ar/" class="pagination--pager" title="Fiducial Marker Tracking ​for Augmented Reality
">Previous</a>
    
    
      <a href="/pages/dcyoung/post-visualizing-runtime-flowpath-in-vr/" class="pagination--pager" title="Visualizing Runtime Flowpath in VR
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="utterances-comments"></section>
    
</div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You May Also Enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/pages/dcyoung/images/r3f-nn-visualizer/preview.webp" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/pages/dcyoung/post-r3f-nn-visualizer/" rel="permalink">Interactive Neural Network Visualizer
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">An interactive Neural Network visualization built w/ modern web technologies including tensorflow.js and react-three-fiber.
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/pages/dcyoung/images/mmle-scores/softmax.webp" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/pages/dcyoung/post-mmle-scores/" rel="permalink">Practical ML: Detecting Out-of-Distribution Data
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Detecting out of distribution samples using
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/pages/dcyoung/images/gh-pages-staging-deployments/preview.webp" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/pages/dcyoung/post-gh-pages-staging-deployments/" rel="permalink">Automating Free Staging Deployments for Github Pages
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Automating free staging deployments for Github Pages using Github Actions.
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/pages/dcyoung/images/clustering-custom-distance/haversine.webp" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/pages/dcyoung/post-clustering-custom-distance/" rel="permalink">Performant Clustering of Geo Coordinates w/ Custom Distance Functions
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Implementing vectorized clustering methods for distance metrics unsupported by common libraries.
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/dcyoung" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.instagram.com/cycle_shadez/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    
      <li><a href="/pages/dcyoung/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 <a href="https://dcyoung.github.io">David Young</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/pages/dcyoung/assets/js/main.min.js"></script>




<script src="/pages/dcyoung/assets/js/lunr/lunr.min.js"></script>
<script src="/pages/dcyoung/assets/js/lunr/lunr-store.js"></script>
<script src="/pages/dcyoung/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8LFRSKS1E8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8LFRSKS1E8', { 'anonymize_ip': false});
</script>






    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'dcyoung/dcyoung.github.io');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('label', 'comment');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  




  </body>
</html>
